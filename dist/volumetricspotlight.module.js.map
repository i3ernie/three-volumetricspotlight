{"version":3,"file":"volumetricspotlight.module.js","sources":["../src/Material.Volumetricspotlight.module.js","../src/Volumetricspotlight.module.js"],"sourcesContent":["import * as THREE from \"../node_modules/three/build/three.module.js\"\n\nconst defaults = {\n\tcolor : \"cyan\"\n};\nconst VolumetricSpotLightMaterial\t= function( opts ){\n\t// \n\tconst vertexShader\t= [\n\t\t'varying vec3 vNormal;',\n\t\t'varying vec3 vWorldPosition;',\n\t\t\n\t\t'void main(){',\n\t\t\t'// compute intensity',\n\t\t\t'vNormal\t\t= normalize( normalMatrix * normal );',\n\n\t\t\t'vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );',\n\t\t\t'vWorldPosition\t\t= worldPosition.xyz;',\n\n\t\t\t'// set gl_Position',\n\t\t\t'gl_Position\t= projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n\t\t'}',\n\t].join('\\n')\n\tconst fragmentShader\t= [\n\t\t'varying vec3\t\tvNormal;',\n\t\t'varying vec3\t\tvWorldPosition;',\n\n\t\t'uniform vec3\t\tlightColor;',\n\n\t\t'uniform vec3\t\tspotPosition;',\n\n\t\t'uniform float\t\tattenuation;',\n\t\t'uniform float\t\tanglePower;',\n\n\t\t'void main(){',\n\t\t\t'float intensity;',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// distance attenuation\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t'intensity\t= distance(vWorldPosition, spotPosition)/attenuation;',\n\t\t\t'intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// intensity on angle\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t'vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));',\n\t\t\t'float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );',\n\t\t\t'intensity\t= intensity * angleIntensity;',\t\t\n\t\t\t// 'gl_FragColor\t= vec4( lightColor, intensity );',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// final color\t\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\n\t\t\t// set the final color\n\t\t\t'gl_FragColor\t= vec4( lightColor, intensity);',\n\t\t'}',\n\t].join('\\n');\n\n\tlet options = Object.assign({}, defaults, opts);\n\n\tlet color = new THREE.Color( options.color );\n\t// create custom material from the shader code above\n\t//   that is within specially labeled script tags\n\tconst material\t= new THREE.ShaderMaterial({\n\t\tuniforms: { \n\t\t\tattenuation\t: {\n\t\t\t\ttype\t: \"f\",\n\t\t\t\tvalue\t: 5.0\n\t\t\t},\n\t\t\tanglePower\t: {\n\t\t\t\ttype\t: \"f\",\n\t\t\t\tvalue\t: 1.2\n\t\t\t},\n\t\t\tspotPosition\t\t: {\n\t\t\t\ttype\t: \"v3\",\n\t\t\t\tvalue\t: new THREE.Vector3( 0, 0, 0 )\n\t\t\t},\n\t\t\tlightColor\t: {\n\t\t\t\ttype\t: \"c\",\n\t\t\t\tvalue\t: color\n\t\t\t},\n\t\t},\n\t\tvertexShader\t: vertexShader,\n\t\tfragmentShader\t: fragmentShader,\n\t\t// side\t\t: THREE.DoubleSide,\n\t\t// blending\t: THREE.AdditiveBlending,\n\t\ttransparent\t: true,\n\t\tdepthWrite\t: false,\n\t});\n\n\treturn material;\n}\n\nexport default VolumetricSpotLightMaterial;","import * as THREE from \"../node_modules/three/build/three.module.js\";\nimport VolumetricSpotLightMaterial from\"./Material.Volumetricspotlight.module.js\"; \n\n//class Mesh extends Object3D\nclass Volumetric extends THREE.Mesh {\n\n    constructor ( opts ) {\n\n        const defaults = {\n            height : 5,\n            angle : Math.PI/6,\n            size : .1\n        };\n\n        super();\n\n        const o = this.options = Object.assign({}, defaults, opts);\n    \n       this.geometry = this.getGeo();\n        // var geometry\t= new THREE.BoxGeometry( 3, 1, 3 );\n        // var material\t= new THREE.MeshNormalMaterial({\n        // \tside\t: THREE.DoubleSide\n        // });\n        // var material\t= new THREE.MeshPhongMaterial({\n        // \tcolor\t\t: 0x000000,\n        // \twireframe\t: true,\n        // })\n        this.material = new VolumetricSpotLightMaterial( o );\n\n        this.material.uniforms.spotPosition.value\t= this.position;\n    }\n\n    getGeo () {\n        const o = this.options;\n\n        let geo\t= new THREE.CylinderGeometry( o.size, o.height*Math.tan( o.angle ), o.height, 32*2, 20, true);\n        geo.applyMatrix4( new THREE.Matrix4().makeTranslation( 0, -geo.parameters.height/2, 0 ) );\n        geo.applyMatrix4( new THREE.Matrix4().makeRotationX( -Math.PI / 2 ) );\n        geo.computeVertexNormals();\n\n        return geo;\n    }\n\n    update () {\n        this.material.uniforms.spotPosition.value\t= this.parent.position;\n        this.options.angle = this.parent.light.angle;\n        this.geometry.dispose();\n        this.geometry = this.getGeo();\n    }\n};\n\n\nclass SpotLight extends THREE.SpotLight {\n\n    constructor ( opts ) {\n    \n        super(); \n\n        let color = typeof opts.color === \"string\"? new THREE.Color( opts.color ): opts.color;\n        \n        this.color\t\t= color;\n        this.angle\t\t= opts.angle;\n        this.intensity\t= opts.intensity;\n        this.penumbra   = opts.penumbra;\n        this.decay      = opts.decay;\n\n        this.enableShadow();\n    }\n\n    enableShadow () {\n        this.castShadow\t= true;\n        this.shadow.camera.near\t= 0.01;\n        this.shadow.camera.far\t= 15;\n        this.shadow.camera.fov\t= 45;\n    \n        this.shadow.camera.left\t= -8;\n        this.shadow.camera.right =  8;\n        this.shadow.camera.top\t=  8;\n        this.shadow.camera.bottom= -8;\n\n        this.shadow.mapSize.width\t= 1024\n        this.shadow.mapSize.height\t= 1024\n\n        this.shadow.bias\t= 0.0;\n    }\n};\n\nconst defaults = {\n    intensity : 2,\n    penumbra : .1,\n    angle : Math.PI/6,\n    decay : 1,\n    size : .05\n};\n\nclass Volumetricspotlight extends THREE.Object3D {\n    constructor ( opts ) {\n\n        super();\n\n        let o = this.options = Object.assign({}, defaults, opts);\n\n\n        this.volume = new Volumetric( o );\n        this.volume.position.set( 0,1,0 );\n\n        o.color = this.volume.material.uniforms.lightColor.value;\n\n        this.light = new SpotLight( o );\n        \n        \n        \n        this.add( this.light );\n        this.add( this.volume );\n\n    \n        if ( o.target ){ \n            if ( o.target instanceof THREE.Object3D || o.target instanceof THREE.Vector3 ) { \n                this.follow = o.target;\n                this.volume.lookAt( o.target );\n                this.light.target.position.copy( o.target );\n            } else {\n                let t = new THREE.Object3D()\n                this.follow = t.position;\n                t.position.set( o.target[0], o.target[1], o.target[2] );\n                this.volume.lookAt( this.follow );\n                this.light.add( t );\n                this.light.target.position.copy( this.follow );\n            }\n        }\n    }\n\n    update () { \n        if ( this.follow ){\n            this.volume.lookAt( this.follow );\n            this.light.target.position.copy( this.follow );\n            this.volume.update();\n        }\n    }\n};\n\n\n\n// doesnt seems to work - not moving with the spotLight\n// var helper\t= new THREE.SpotLightHelper(spotLight)\n// scene.add(helper)\n// onRenderFcts.push(function(delta, now){\n// \thelper.update()\n// })\n\n\nexport {Volumetricspotlight, Volumetric, SpotLight, VolumetricSpotLightMaterial};\nexport default Volumetricspotlight;"],"names":["defaults"],"mappings":"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"}