{"version":3,"file":"volumetricspotlight.amd.js","sources":["../src/Material.Volumetricspotlight.module.js","../src/Volumetricspotlight.module.js"],"sourcesContent":["import * as THREE from \"../node_modules/three/build/three.module.js\"\n\nconst VolumetricSpotLightMaterial\t= function(){\n\t// \n\tvar vertexShader\t= [\n\t\t'varying vec3 vNormal;',\n\t\t'varying vec3 vWorldPosition;',\n\t\t\n\t\t'void main(){',\n\t\t\t'// compute intensity',\n\t\t\t'vNormal\t\t= normalize( normalMatrix * normal );',\n\n\t\t\t'vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );',\n\t\t\t'vWorldPosition\t\t= worldPosition.xyz;',\n\n\t\t\t'// set gl_Position',\n\t\t\t'gl_Position\t= projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n\t\t'}',\n\t].join('\\n')\n\tvar fragmentShader\t= [\n\t\t'varying vec3\t\tvNormal;',\n\t\t'varying vec3\t\tvWorldPosition;',\n\n\t\t'uniform vec3\t\tlightColor;',\n\n\t\t'uniform vec3\t\tspotPosition;',\n\n\t\t'uniform float\t\tattenuation;',\n\t\t'uniform float\t\tanglePower;',\n\n\t\t'void main(){',\n\t\t\t'float intensity;',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// distance attenuation\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t'intensity\t= distance(vWorldPosition, spotPosition)/attenuation;',\n\t\t\t'intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// intensity on angle\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t'vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));',\n\t\t\t'float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );',\n\t\t\t'intensity\t= intensity * angleIntensity;',\t\t\n\t\t\t// 'gl_FragColor\t= vec4( lightColor, intensity );',\n\n\t\t\t//////////////////////////////////////////////////////////\n\t\t\t// final color\t\t\t\t\t\t//\n\t\t\t//////////////////////////////////////////////////////////\n\n\t\t\t// set the final color\n\t\t\t'gl_FragColor\t= vec4( lightColor, intensity);',\n\t\t'}',\n\t].join('\\n')\n\n\t// create custom material from the shader code above\n\t//   that is within specially labeled script tags\n\tvar material\t= new THREE.ShaderMaterial({\n\t\tuniforms: { \n\t\t\tattenuation\t: {\n\t\t\t\ttype\t: \"f\",\n\t\t\t\tvalue\t: 5.0\n\t\t\t},\n\t\t\tanglePower\t: {\n\t\t\t\ttype\t: \"f\",\n\t\t\t\tvalue\t: 1.2\n\t\t\t},\n\t\t\tspotPosition\t\t: {\n\t\t\t\ttype\t: \"v3\",\n\t\t\t\tvalue\t: new THREE.Vector3( 0, 0, 0 )\n\t\t\t},\n\t\t\tlightColor\t: {\n\t\t\t\ttype\t: \"c\",\n\t\t\t\tvalue\t: new THREE.Color('cyan')\n\t\t\t},\n\t\t},\n\t\tvertexShader\t: vertexShader,\n\t\tfragmentShader\t: fragmentShader,\n\t\t// side\t\t: THREE.DoubleSide,\n\t\t// blending\t: THREE.AdditiveBlending,\n\t\ttransparent\t: true,\n\t\tdepthWrite\t: false,\n\t});\n\treturn material\n}\n\nexport default VolumetricSpotLightMaterial;","import * as THREE from \"../node_modules/three/build/three.module.js\";\nimport VolumetricSpotLightMaterial from\"./Material.Volumetricspotlight.module.js\"; \n\n\nconst Volumetric = function( opts ){\n    const defaults = {\n        height : 5,\n        angle : Math.PI/6\n    };\n\n    const o = this.options = Object.assign({}, defaults, opts);\n   \n\tlet geo\t= this.getGeo();\n\t// var geometry\t= new THREE.BoxGeometry( 3, 1, 3 );\n\t// var material\t= new THREE.MeshNormalMaterial({\n\t// \tside\t: THREE.DoubleSide\n\t// });\n\t// var material\t= new THREE.MeshPhongMaterial({\n\t// \tcolor\t\t: 0x000000,\n\t// \twireframe\t: true,\n\t// })\n\tlet material\t= new VolumetricSpotLightMaterial()\n    THREE.Mesh.call( this, geo, material );\n\n    \n\tmaterial.uniforms.lightColor.value.set('white')\n    material.uniforms.spotPosition.value\t= this.position;\n};\n\nVolumetric.prototype = Object.assign( Object.create( THREE.Mesh.prototype ),{\n    constructor : Volumetric,\n    getGeo : function(){\n        let geo\t= new THREE.CylinderGeometry( .1, this.options.height*Math.tan( this.options.angle ), this.options.height, 32*2, 20, true);\n        geo.applyMatrix4( new THREE.Matrix4().makeTranslation( 0, -geo.parameters.height/2, 0 ) );\n        geo.applyMatrix4( new THREE.Matrix4().makeRotationX( -Math.PI / 2 ) );\n        geo.computeVertexNormals();\n        return geo;\n    },\n    update : function(){\n        this.material.uniforms.spotPosition.value\t= this.parent.position;\n        this.options.angle = this.parent.light.angle;\n        this.geometry.dispose();\n        this.geometry = this.getGeo();\n    }\n});\n\n\nconst SpotLight = function( opts ) {\n    THREE.SpotLight.call( this );\n\n    this.color\t\t= opts.color;\n    this.angle\t\t= opts.angle;\n    this.intensity\t= opts.intensity;\n    this.penumbra   = opts.penumbra;\n    this.decay      = opts.decay;\n\n    this.enableShadow();\n};\n\nSpotLight.prototype = Object.assign( Object.create( THREE.SpotLight.prototype ), {\n    constructor : SpotLight,\n\n    enableShadow : function(){\n        this.castShadow\t= true;\n        this.shadow.camera.near\t= 0.01;\n        this.shadow.camera.far\t= 15;\n        this.shadow.camera.fov\t= 45;\n    \n        this.shadow.camera.left\t= -8;\n        this.shadow.camera.right =  8;\n        this.shadow.camera.top\t=  8;\n        this.shadow.camera.bottom= -8;\n\n        this.shadow.mapSize.width\t= 1024\n        this.shadow.mapSize.height\t= 1024\n\n        this.shadow.bias\t= 0.0;\n    }\n});\n\nconst defaults = {\n    intensity : 3,\n    penumbra : .1,\n    angle : Math.PI/6,\n    decay : 1\n};\n\nconst Volumetricspotlight = function( opts ){\n    let o = this.options = Object.assign({}, defaults, opts);\n\n    this.volume = new Volumetric();\n    this.volume.position.set( 0,1,0 );\n\n    o.color = this.volume.material.uniforms.lightColor.value;\n\n    this.light = new SpotLight( o );\n    \n    THREE.Object3D.call( this );\n    \n    this.add( this.light );\n    this.add( this.volume );\n\n    \n\n    if ( o.follow ){ \n        this.follow = o.follow;\n        this.volume.lookAt( o.follow );\n\t\tthis.light.target.position.copy( o.follow );\n    }\n\n};\n\nVolumetricspotlight.prototype = Object.assign( Object.create( THREE.Object3D.prototype ),{\n    constructor : Volumetricspotlight,\n    update : function(){\n        if ( this.follow ){\n            this.volume.lookAt( this.follow );\n            this.light.target.position.copy( this.follow );\n            this.volume.update();\n        }\n    }\n});\n\n\n\n// doesnt seems to work - not moving with the spotLight\n// var helper\t= new THREE.SpotLightHelper(spotLight)\n// scene.add(helper)\n// onRenderFcts.push(function(delta, now){\n// \thelper.update()\n// })\n\n\nexport {Volumetricspotlight, Volumetric, SpotLight};\nexport default Volumetricspotlight;"],"names":["THREE.ShaderMaterial","THREE.Vector3","THREE.Color","THREE.Mesh","THREE.CylinderGeometry","THREE.Matrix4","THREE.SpotLight","THREE.Object3D"],"mappings":"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"}